import std.*;

public proc void foo(barrier b, chan<int>.read r, timer t) {
    b.sync();
    int d = r.read();
    long time = t.read();
    t.timeout(1000);
    println("read: " + d + ", time: " + time);
}

public proc void bar(barrier b, chan<int>.write w) {
    b.sync();
    w.write(5);
}

public proc void f(int i) [yield=true] { println("f(" + i + ")"); }
public proc void b(int i) [yield=true] { println("b(" + i + ")"); }

public proc void main(string args[]) {
    timer t;
    barrier b;
    chan<int> c;
    par enroll (b) {
        bar(b, c.write);
        foo(b, c.read, t);
    }
    //int i = 0;
    //par {
    //    f(i);
    //    b(i + 1);
    //}
    //i = 7;
}